<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathMaster - é«˜ä¸­æ•°å­¦å­¦ä¹ å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #67c23a;
            --warning-color: #e6a23c;
            --danger-color: #f56c6c;
            --info-color: #909399;
            --text-primary: #303133;
            --text-regular: #606266;
            --text-secondary: #909399;
            --border-color: #dcdfe6;
            --background-color: #f5f5f5;
            --card-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* å¯¼èˆªæ  */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: var(--card-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-regular);
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--primary-color);
        }

        /* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */
        .user-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 40px;
            align-items: center;
        }

        .user-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: white;
            margin: 0 auto;
        }

        .user-info h2 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .user-info p {
            color: var(--text-regular);
            margin-bottom: 5px;
        }

        .user-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--background-color);
            border-radius: 10px;
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-color);
            display: block;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 5px;
        }

        /* å­¦ä¹ æ¨¡å— */
        .learning-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
        }

        .tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-regular);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .themes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .theme-card {
            background: var(--background-color);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .theme-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-shadow);
            border-color: var(--primary-color);
        }

        .theme-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .theme-card h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .theme-card p {
            color: var(--text-regular);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-link {
            background: transparent;
            color: #7c3aed;
            text-decoration: none;
            padding: 8px 16px;
            border: none;
            cursor: pointer;
        }

        .btn-link:hover {
            text-decoration: underline;
            color: #6d28d9;
        }

        /* å…³å¡ç³»ç»Ÿ */
        .levels-container {
            display: grid;
            gap: 30px;
        }

        .theme-levels {
            background: var(--background-color);
            border-radius: 15px;
            padding: 25px;
        }

        .theme-levels h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .levels-grid {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .level-item {
            width: 60px;
            height: 60px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            background: white;
        }

        .level-item:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: scale(1.1);
        }

        .level-item.completed {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        /* å¿ƒå¾—æ¨¡å— */
        .notes-grid {
            display: grid;
            gap: 20px;
        }

        .note-card {
            background: var(--background-color);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
        }

        .note-card:hover {
            box-shadow: var(--card-shadow);
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .note-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .note-type {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .type-basic {
            background: #e3f2fd;
            color: #1976d2;
        }

        .type-advanced {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .type-challenge {
            background: #ffebee;
            color: #c62828;
        }

        .note-content {
            color: var(--text-regular);
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .note-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .note-actions {
            display: flex;
            gap: 15px;
        }

        .note-actions span {
            cursor: pointer;
            transition: color 0.3s;
        }

        .note-actions span:hover {
            color: var(--primary-color);
        }

        /* å…³äºæˆ‘ä»¬ */
        .about-content {
            background: var(--background-color);
            border-radius: 15px;
            padding: 30px;
            line-height: 1.8;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .team-member {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
        }

        .member-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
        }

        /* è”ç³»æˆ‘ä»¬ */
        .contact-form {
            background: var(--background-color);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 120px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .nav-links {
                display: none;
            }

            .user-card {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .user-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .themes-grid {
                grid-template-columns: 1fr;
            }

            .levels-grid {
                justify-content: center;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        /* éšè—é¡µé¢ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* é¡µé¢å†…å®¹æ˜¾ç¤º/éšè— */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* ç™»å½•ç•Œé¢ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .demo-info {
            background: var(--background-color);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
            color: var(--text-regular);
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é¡µé¢ -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <!-- ç™»å½•è¡¨å• -->
            <div id="loginCard" class="login-card fade-in">
                <div class="login-header">
                    <h1>ğŸ“ MathMaster</h1>
                    <p>é«˜ä¸­æ•°å­¦å­¦ä¹ å¹³å°</p>
                </div>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" class="form-control" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" class="form-control" id="password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆå¯ç•™ç©ºï¼‰">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px; padding: 12px;">
                        ç™»å½•
                    </button>
                    <button type="button" id="quickLoginBtn" class="btn btn-success" style="width: 100%; margin-top: 10px; padding: 12px;">
                        å¿«é€Ÿä½“éªŒ
                    </button>
                </form>
                
                <div class="demo-info">
                    <p><strong>æ¼”ç¤ºè´¦å·ï¼š</strong></p>
                    <p>ç”¨æˆ·åï¼šdemo</p>
                    <p>å¯†ç ï¼šdemoï¼ˆæˆ–ç•™ç©ºï¼‰</p>
                </div>
                
                <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                    <p style="color: #666; margin-bottom: 10px;">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ</p>
                    <button type="button" id="switchToRegisterBtn" class="btn btn-link" style="color: #7c3aed; text-decoration: none;">
                        ç«‹å³æ³¨å†Œ
                    </button>
                </div>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div id="registerCard" class="login-card fade-in" style="display: none;">
                <div class="login-header">
                    <h1>ğŸ“ MathMaster</h1>
                    <p>åˆ›å»ºæ–°è´¦å·</p>
                </div>
                
                <form id="registerForm">
                    <div class="form-group">
                        <label>ç”¨æˆ·å <span style="color: #999;">(3-20ä¸ªå­—ç¬¦)</span></label>
                        <input type="text" class="form-control" id="regUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required minlength="3" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label>å¯†ç  <span style="color: #999;">(è‡³å°‘6ä¸ªå­—ç¬¦)</span></label>
                        <input type="password" class="form-control" id="regPassword" placeholder="è¯·è¾“å…¥å¯†ç " required minlength="6">
                    </div>
                    <div class="form-group">
                        <label>ç¡®è®¤å¯†ç </label>
                        <input type="password" class="form-control" id="regPasswordConfirm" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required minlength="6">
                    </div>
                    <div class="form-group">
                        <label>å§“å <span style="color: #999;">(å¯é€‰)</span></label>
                        <input type="text" class="form-control" id="regName" placeholder="è¯·è¾“å…¥å§“å">
                    </div>
                    <div class="form-group">
                        <label>å¹´çº§ <span style="color: #999;">(å¯é€‰)</span></label>
                        <select class="form-control" id="regGrade">
                            <option value="">è¯·é€‰æ‹©å¹´çº§</option>
                            <option value="é«˜ä¸€">é«˜ä¸€</option>
                            <option value="é«˜äºŒ">é«˜äºŒ</option>
                            <option value="é«˜ä¸‰">é«˜ä¸‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ•°å­¦ç‰¹é•¿ <span style="color: #999;">(å¯é€‰)</span></label>
                        <input type="text" class="form-control" id="regSpecialty" placeholder="ä¾‹å¦‚ï¼šå‡½æ•°ä¸å¯¼æ•°">
                    </div>
                    <div class="form-group">
                        <label>å­¦ä¹ ç›®æ ‡ <span style="color: #999;">(å¯é€‰)</span></label>
                        <input type="text" class="form-control" id="regLearningGoal" placeholder="ä¾‹å¦‚ï¼šå†²å‡»é«˜è€ƒæ•°å­¦145+">
                    </div>
                    <div class="form-group">
                        <label>æŒ‘æˆ˜æ–¹å‘ <span style="color: #999;">(å¯é€‰)</span></label>
                        <input type="text" class="form-control" id="regChallengeDirection" placeholder="ä¾‹å¦‚ï¼šå‡½æ•°ç»¼åˆé¢˜ã€å¯¼æ•°åº”ç”¨">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px; padding: 12px;">
                        æ³¨å†Œ
                    </button>
                </form>
                
                <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                    <p style="color: #666; margin-bottom: 10px;">å·²æœ‰è´¦å·ï¼Ÿ</p>
                    <button type="button" id="switchToLoginBtn" class="btn btn-link" style="color: #7c3aed; text-decoration: none;">
                        è¿”å›ç™»å½•
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ -->
    <div id="mainApp" class="page">
        <div class="container">
            <!-- å¯¼èˆªæ  -->
            <header>
                <nav>
                    <div class="logo">
                        ğŸ“ MathMaster
                    </div>
                    <ul class="nav-links">
                        <li><a href="#" onclick="showPage('dashboard', this); return false;" class="nav-link active">é¦–é¡µ</a></li>
                        <li><a href="#" onclick="showPage('contextLearning', this); return false;" class="nav-link">æƒ…å¢ƒå­¦ä¹ </a></li>
                        <li><a href="#" onclick="showPage('practiceLearning', this); return false;" class="nav-link">åˆ·é¢˜é—¯å…³</a></li>
                        <li><a href="#" onclick="showPage('notes', this); return false;" class="nav-link">å¿ƒå¾—</a></li>
                        <li><a href="#" onclick="showPage('about', this); return false;" class="nav-link">å…³äº</a></li>
                        <li><a href="#" onclick="showPage('contact', this); return false;" class="nav-link">è”ç³»</a></li>
                        <li><a href="#" onclick="logout()">é€€å‡º</a></li>
                    </ul>
                </nav>
            </header>

            <!-- é¦–é¡µ -->
            <div id="dashboard" class="page-content active">
                <div class="user-card fade-in">
                    <div class="user-avatar">ğŸ‘¨â€ğŸ“</div>
                    <div class="user-info">
                        <h2 id="userName">æ•°å­¦å°è¾¾äºº</h2>
                        <p><strong>å¹´çº§ï¼š</strong><span id="userGrade">é«˜äºŒ</span></p>
                        <p><strong>æ•°å­¦ç‰¹é•¿ï¼š</strong><span id="userSpecialty">å‡½æ•°ä¸å¯¼æ•°</span></p>
                        <p><strong>å­¦ä¹ ç›®æ ‡ï¼š</strong><span id="userGoal">å†²å‡»é«˜è€ƒæ•°å­¦145+</span></p>
                        <p><strong>æŒ‘æˆ˜æ–¹å‘ï¼š</strong><span id="userChallenge">å‡½æ•°ç»¼åˆé¢˜ã€å¯¼æ•°åº”ç”¨</span></p>
                        
                        <div class="user-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="completedLevels">12</span>
                                <span class="stat-label">å·²é€šå…³</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="notesCount">8</span>
                                <span class="stat-label">å¿ƒå¾—æ•°</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="consecutiveDays">15</span>
                                <span class="stat-label">è¿ç»­å¤©æ•°</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="points">380</span>
                                <span class="stat-label">ç§¯åˆ†</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="learning-section fade-in">
                    <div class="section-header">
                        <h2 class="section-title">ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <button class="btn btn-primary" style="padding: 15px; font-size: 16px;" onclick="showPage('contextLearning'); return false;">
                            ğŸŒŸ æƒ…å¢ƒå­¦ä¹ 
                        </button>
                        <button class="btn btn-primary" style="padding: 15px; font-size: 16px;" onclick="showPage('practiceLearning'); return false;">
                            ğŸ¯ åˆ·é¢˜é—¯å…³
                        </button>
                        <button class="btn btn-primary" style="padding: 15px; font-size: 16px;" onclick="showPage('notes'); return false;">
                            ğŸ’¡ æŸ¥çœ‹å¿ƒå¾—
                        </button>
                        <button class="btn btn-primary" style="padding: 15px; font-size: 16px;" onclick="doCheckIn()">
                            ğŸ“… æ¯æ—¥æ‰“å¡
                        </button>
                    </div>
                </div>
            </div>

            <!-- æƒ…å¢ƒå­¦ä¹ é¡µé¢ -->
            <div id="contextLearning" class="page-content">
                <div class="learning-section fade-in">
                    <div class="section-header">
                        <h2 class="section-title">ğŸŒŸ æƒ…å¢ƒå¼•å®šä¹‰</h2>
                        <p style="color: var(--text-regular); margin-top: 10px;">é€šè¿‡çœŸå®æƒ…å¢ƒå¼•å…¥æ•°å­¦æ¦‚å¿µï¼Œè®©å­¦ä¹ æ›´æœ‰è¶£</p>
                    </div>
                    
                    <div class="themes-grid">
                        <div class="theme-card">
                            <div class="theme-icon">ğŸ¡</div>
                            <h3>å‡½æ•°çš„å¥¥ç§˜</h3>
                            <p>é€šè¿‡æ¸¸ä¹å›­æ‘©å¤©è½®çš„è¿åŠ¨è½¨è¿¹ï¼Œç†è§£å‡½æ•°è¾“å…¥ä¸è¾“å‡ºçš„å…³ç³»ï¼Œæ„Ÿå—æ•°å­¦æè¿°ç°å®ä¸–ç•Œçš„ç¾å¦™ã€‚</p>
                            <button class="btn btn-primary" onclick="startTheme('å‡½æ•°çš„å¥¥ç§˜')">å¼€å§‹å­¦ä¹ </button>
                        </div>
                        
                        <div class="theme-card">
                            <div class="theme-icon">ğŸ§¬</div>
                            <h3>æŒ‡æ•°ä¸å¯¹æ•°</h3>
                            <p>è§‚å¯Ÿç”Ÿç‰©ç»†èƒåˆ†è£‚è¿‡ç¨‹ï¼Œä½“éªŒæŒ‡æ•°çˆ†ç‚¸å¼å¢é•¿ï¼Œç†è§£æŒ‡æ•°å‡½æ•°çš„å¨åŠ›ä¸å¯¹æ•°çš„è¿ç®—è§„å¾‹ã€‚</p>
                            <button class="btn btn-primary" onclick="startTheme('æŒ‡æ•°ä¸å¯¹æ•°')">å¼€å§‹å­¦ä¹ </button>
                        </div>
                        
                        <div class="theme-card">
                            <div class="theme-icon">ğŸŒŠ</div>
                            <h3>ä¸‰è§’å‡½æ•°</h3>
                            <p>é€šè¿‡æµ·æ´‹æ½®æ±çš„å‘¨æœŸæ€§æ¶¨è½ï¼ŒæŒæ¡ä¸‰è§’å‡½æ•°çš„å‘¨æœŸç‰¹æ€§ï¼Œç†è§£æ­£å¼¦ä½™å¼¦çš„æ³¢åŠ¨è§„å¾‹ã€‚</p>
                            <button class="btn btn-primary" onclick="startTheme('ä¸‰è§’å‡½æ•°')">å¼€å§‹å­¦ä¹ </button>
                        </div>
                        
                        <div class="theme-card">
                            <div class="theme-icon">ğŸ’°</div>
                            <h3>æ•°åˆ—ä¸æ±‚å’Œ</h3>
                            <p>é€šè¿‡ç†è´¢æŠ•èµ„çš„å¤åˆ©è®¡ç®—ï¼Œä½“ä¼šæ•°åˆ—é€’æ¨ä¸æ±‚å’Œçš„å®é™…åº”ç”¨ï¼ŒæŒæ¡æ•°å­¦å»ºæ¨¡æ€ç»´ã€‚</p>
                            <button class="btn btn-primary" onclick="startTheme('æ•°åˆ—ä¸æ±‚å’Œ')">å¼€å§‹å­¦ä¹ </button>
                        </div>
                        
                        <div class="theme-card">
                            <div class="theme-icon">ğŸš—</div>
                            <h3>å¯¼æ•°åˆæ¢</h3>
                            <p>åˆ†ææ±½è½¦ä»é™æ­¢åˆ°é«˜é€Ÿçš„åŠ é€Ÿæ›²çº¿ï¼Œç†è§£å¯¼æ•°æè¿°å˜åŒ–ç‡çš„æœ¬è´¨ï¼ŒæŒæ¡å¾®ç§¯åˆ†åŸºç¡€ã€‚</p>
                            <button class="btn btn-primary" onclick="startTheme('å¯¼æ•°åˆæ¢')">å¼€å§‹å­¦ä¹ </button>
                        </div>
                        
                        <div class="theme-card">
                            <div class="theme-icon">ğŸ²</div>
                            <h3>æ¦‚ç‡ç»Ÿè®¡</h3>
                            <p>é€šè¿‡æ—¥å¸¸æŠ½å¥–æ¸¸æˆï¼Œç†è§£æ¦‚ç‡ç»Ÿè®¡çš„åŸºæœ¬æ¦‚å¿µï¼Œå­¦ä¼šç”¨æ•°å­¦æ€ç»´åˆ†æéšæœºäº‹ä»¶ã€‚</p>
                            <button class="btn btn-primary" onclick="startTheme('æ¦‚ç‡ç»Ÿè®¡')">å¼€å§‹å­¦ä¹ </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åˆ·é¢˜é—¯å…³é¡µé¢ -->
            <div id="practiceLearning" class="page-content">
                <div class="learning-section fade-in">
                    <div class="section-header">
                        <h2 class="section-title">ğŸ¯ åˆ·é¢˜è¿›é˜¶å­¦</h2>
                        <p style="color: var(--text-regular); margin-top: 10px;">é€šè¿‡é—¯å…³ç»ƒä¹ å·©å›ºçŸ¥è¯†ï¼Œæå‡è§£é¢˜èƒ½åŠ›</p>
                    </div>
                    
                    <div class="levels-container">
                        <div class="theme-levels">
                            <h3>ğŸ¡ å‡½æ•°çš„å¥¥ç§˜</h3>
                            <div class="levels-grid">
                                <div class="level-item completed" data-theme="å‡½æ•°çš„å¥¥ç§˜" data-level="1">âœ“</div>
                                <div class="level-item completed" data-theme="å‡½æ•°çš„å¥¥ç§˜" data-level="2">âœ“</div>
                                <div class="level-item completed" data-theme="å‡½æ•°çš„å¥¥ç§˜" data-level="3">âœ“</div>
                                <div class="level-item" data-theme="å‡½æ•°çš„å¥¥ç§˜" data-level="4">4</div>
                                <div class="level-item" data-theme="å‡½æ•°çš„å¥¥ç§˜" data-level="5">5</div>
                                <div class="level-item" data-theme="å‡½æ•°çš„å¥¥ç§˜" data-level="6">6</div>
                            </div>
                        </div>
                        
                        <div class="theme-levels">
                            <h3>ğŸ§¬ æŒ‡æ•°ä¸å¯¹æ•°</h3>
                            <div class="levels-grid">
                                <div class="level-item completed" data-theme="æŒ‡æ•°ä¸å¯¹æ•°" data-level="1">âœ“</div>
                                <div class="level-item completed" data-theme="æŒ‡æ•°ä¸å¯¹æ•°" data-level="2">âœ“</div>
                                <div class="level-item" data-theme="æŒ‡æ•°ä¸å¯¹æ•°" data-level="3">3</div>
                                <div class="level-item" data-theme="æŒ‡æ•°ä¸å¯¹æ•°" data-level="4">4</div>
                                <div class="level-item" data-theme="æŒ‡æ•°ä¸å¯¹æ•°" data-level="5">5</div>
                                <div class="level-item" data-theme="æŒ‡æ•°ä¸å¯¹æ•°" data-level="6">6</div>
                            </div>
                        </div>
                        
                        <div class="theme-levels">
                            <h3>ğŸŒŠ ä¸‰è§’å‡½æ•°</h3>
                            <div class="levels-grid">
                                <div class="level-item completed" data-theme="ä¸‰è§’å‡½æ•°" data-level="1">âœ“</div>
                                <div class="level-item" data-theme="ä¸‰è§’å‡½æ•°" data-level="2">2</div>
                                <div class="level-item" data-theme="ä¸‰è§’å‡½æ•°" data-level="3">3</div>
                                <div class="level-item" data-theme="ä¸‰è§’å‡½æ•°" data-level="4">4</div>
                                <div class="level-item" data-theme="ä¸‰è§’å‡½æ•°" data-level="5">5</div>
                                <div class="level-item" data-theme="ä¸‰è§’å‡½æ•°" data-level="6">6</div>
                            </div>
                        </div>
                        
                        <div class="theme-levels">
                            <h3>ğŸ’° æ•°åˆ—ä¸æ±‚å’Œ</h3>
                            <div class="levels-grid">
                                <div class="level-item completed" data-theme="æ•°åˆ—ä¸æ±‚å’Œ" data-level="1">âœ“</div>
                                <div class="level-item" data-theme="æ•°åˆ—ä¸æ±‚å’Œ" data-level="2">2</div>
                                <div class="level-item" data-theme="æ•°åˆ—ä¸æ±‚å’Œ" data-level="3">3</div>
                                <div class="level-item" data-theme="æ•°åˆ—ä¸æ±‚å’Œ" data-level="4">4</div>
                                <div class="level-item" data-theme="æ•°åˆ—ä¸æ±‚å’Œ" data-level="5">5</div>
                                <div class="level-item" data-theme="æ•°åˆ—ä¸æ±‚å’Œ" data-level="6">6</div>
                            </div>
                        </div>
                        
                        <div class="theme-levels">
                            <h3>ğŸš— å¯¼æ•°åˆæ¢</h3>
                            <div class="levels-grid">
                                <div class="level-item" data-theme="å¯¼æ•°åˆæ¢" data-level="1">1</div>
                                <div class="level-item" data-theme="å¯¼æ•°åˆæ¢" data-level="2">2</div>
                                <div class="level-item" data-theme="å¯¼æ•°åˆæ¢" data-level="3">3</div>
                                <div class="level-item" data-theme="å¯¼æ•°åˆæ¢" data-level="4">4</div>
                                <div class="level-item" data-theme="å¯¼æ•°åˆæ¢" data-level="5">5</div>
                                <div class="level-item" data-theme="å¯¼æ•°åˆæ¢" data-level="6">6</div>
                            </div>
                        </div>
                        
                        <div class="theme-levels">
                            <h3>ğŸ² æ¦‚ç‡ç»Ÿè®¡</h3>
                            <div class="levels-grid">
                                <div class="level-item" data-theme="æ¦‚ç‡ç»Ÿè®¡" data-level="1">1</div>
                                <div class="level-item" data-theme="æ¦‚ç‡ç»Ÿè®¡" data-level="2">2</div>
                                <div class="level-item" data-theme="æ¦‚ç‡ç»Ÿè®¡" data-level="3">3</div>
                                <div class="level-item" data-theme="æ¦‚ç‡ç»Ÿè®¡" data-level="4">4</div>
                                <div class="level-item" data-theme="æ¦‚ç‡ç»Ÿè®¡" data-level="5">5</div>
                                <div class="level-item" data-theme="æ¦‚ç‡ç»Ÿè®¡" data-level="6">6</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸»é¢˜è¯¦æƒ…é¡µé¢ -->
            <div id="themeDetail" class="page-content">
                <div class="learning-section fade-in">
                    <div class="section-header">
                        <button class="btn btn-primary" onclick="showPage('contextLearning'); return false;" style="margin-right: 20px;">â† è¿”å›</button>
                        <h2 class="section-title" id="themeDetailTitle">ğŸ“š ä¸»é¢˜è¯¦æƒ…</h2>
                    </div>
                    <div id="themeDetailContent"></div>
                </div>
            </div>

            <!-- å…³å¡è¯¦æƒ…é¡µé¢ -->
            <div id="levelDetail" class="page-content">
                <div class="learning-section fade-in">
                    <div class="section-header">
                        <button class="btn btn-primary" onclick="goBackFromLevel()" style="margin-right: 20px;">â† è¿”å›</button>
                        <h2 class="section-title" id="levelDetailTitle">ğŸ¯ å…³å¡è¯¦æƒ…</h2>
                    </div>
                    <div id="levelDetailContent"></div>
                </div>
            </div>

            <!-- å¿ƒå¾—é¡µé¢ -->
            <div id="notes" class="page-content">
                <div class="learning-section fade-in">
                    <div class="section-header">
                        <h2 class="section-title">ğŸ’¡ å­¦ä¹ å¿ƒå¾—ä¸è®¨è®º</h2>
                    </div>
                    
                    <div id="notesList" class="notes-grid"></div>
                    
                    <!-- åˆ†é¡µæ§ä»¶ -->
                    <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 30px; padding: 20px;">
                        <button class="btn btn-primary" id="prevPageBtn" onclick="changeNotesPage(-1)" style="padding: 10px 20px;">ä¸Šä¸€é¡µ</button>
                        <span id="pageInfo" style="padding: 10px 20px; color: var(--text-regular);">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                        <button class="btn btn-primary" id="nextPageBtn" onclick="changeNotesPage(1)" style="padding: 10px 20px;">ä¸‹ä¸€é¡µ</button>
                    </div>
                </div>
            </div>

            <!-- å…³äºæˆ‘ä»¬ -->
            <div id="about" class="page-content">
                <div class="learning-section fade-in">
                    <div class="section-header">
                        <h2 class="section-title">ğŸ“– å…³äº MathMaster</h2>
                    </div>
                    
                    <div class="about-content">
                        <h3>ğŸ¯ å¹³å°ä»‹ç»</h3>
                        <p>
                            MathMaster æ˜¯ç”±èµ„æ·±é«˜ä¸­æ•°å­¦æ•™å¸ˆä¸ä¸“ä¸šå¼€å‘å›¢é˜Ÿè”åˆæ‰“é€ çš„åˆ›æ–°æ•°å­¦å­¦ä¹ å¹³å°ã€‚
                            æˆ‘ä»¬åšä¿¡"ä»¥åˆ·é¢˜ä»£å­¦ã€ä»¥æƒ…å¢ƒå¼•å®šä¹‰"çš„æ ¸å¿ƒç†å¿µï¼Œé€šè¿‡çœŸå®æƒ…å¢ƒæ¿€å‘å­¦ä¹ å…´è¶£ï¼Œ
                            è®©å­¦ç”Ÿåœ¨è§£é¢˜ä¸­è‡ªç„¶ç†è§£æŠ½è±¡æ¦‚å¿µï¼Œå®ç°è¾¹å­¦è¾¹ç»ƒã€è¾¹ç»ƒè¾¹é—¯å…³çš„é«˜æ•ˆå­¦ä¹ æ¨¡å¼ã€‚
                        </p>
                        
                        <h3 style="margin-top: 25px;">âœ¨ æ ¸å¿ƒä¼˜åŠ¿</h3>
                        <ul style="margin-left: 20px; line-height: 2;">
                            <li><strong>æƒ…å¢ƒåŒ–å­¦ä¹ ï¼š</strong>å…­å¤§ä¸»é¢˜ï¼Œæ¯ä¸ªéƒ½é€šè¿‡çœŸå®ç”Ÿæ´»æƒ…å¢ƒå¼•å…¥ï¼Œè®©æ•°å­¦ä¸å†æŠ½è±¡</li>
                            <li><strong>æ¢¯åº¦å¼è®­ç»ƒï¼š</strong>ä»åŸºç¡€åˆ°æ‹”é«˜ï¼Œç§‘å­¦è®¾ç½®å…³å¡éš¾åº¦ï¼Œå¾ªåºæ¸è¿›æå‡èƒ½åŠ›</li>
                            <li><strong>ç§¯åˆ†æ¿€åŠ±ç³»ç»Ÿï¼š</strong>é€šå…³è·å¾—ç§¯åˆ†ï¼Œè¿ç»­æ‰“å¡å¥–åŠ±ï¼Œè®©å­¦ä¹ å……æ»¡æˆå°±æ„Ÿ</li>
                            <li><strong>åŒä¼´äº¤æµç¤¾åŒºï¼š</strong>åˆ†äº«å­¦ä¹ å¿ƒå¾—ï¼Œäº¤æµè§£é¢˜æ€è·¯ï¼Œå…±åŒè¿›æ­¥æˆé•¿</li>
                        </ul>
                        
                        <h3 style="margin-top: 25px;">ğŸ‘¥ å›¢é˜Ÿä»‹ç»</h3>
                        <div class="team-grid">
                            <div class="team-member">
                                <div class="member-avatar">ğŸ‘¨â€ğŸ«</div>
                                <h4>ç‹è€å¸ˆ</h4>
                                <p>èµ„æ·±æ•°å­¦æ•™å¸ˆ<br>20å¹´æ•™å­¦ç»éªŒ</p>
                            </div>
                            <div class="team-member">
                                <div class="member-avatar">ğŸ‘©â€ğŸ’»</div>
                                <h4>æå·¥ç¨‹å¸ˆ</h4>
                                <p>æŠ€æœ¯è´Ÿè´£äºº<br>10å¹´å¼€å‘ç»éªŒ</p>
                            </div>
                            <div class="team-member">
                                <div class="member-avatar">ğŸ¨</div>
                                <h4>å¼ è®¾è®¡å¸ˆ</h4>
                                <p>UI/UXè®¾è®¡å¸ˆ<br>ä¸“æ³¨æ•™è‚²äº§å“</p>
                            </div>
                            <div class="team-member">
                                <div class="member-avatar">ğŸ“Š</div>
                                <h4>é™ˆåˆ†æå¸ˆ</h4>
                                <p>æ•°æ®åˆ†æå¸ˆ<br>å­¦ä¹ è¡Œä¸ºç ”ç©¶</p>
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 25px;">ğŸŒŸ å¹³å°æ„¿æ™¯</h3>
                        <p>
                            è®©æ¯ä¸€ä¸ªé«˜ä¸­ç”Ÿéƒ½èƒ½äº«å—æ•°å­¦å­¦ä¹ çš„ä¹è¶£ï¼Œåœ¨è½»æ¾æ„‰å¿«çš„æ°›å›´ä¸­æŒæ¡æ•°å­¦çŸ¥è¯†ï¼Œ
                            å†²å‡»é«˜è€ƒé«˜åˆ†ï¼ŒåŸ¹å…»é€»è¾‘æ€ç»´èƒ½åŠ›ï¼Œä¸ºæœªæ¥çš„å­¦ä¹ å’Œç”Ÿæ´»æ‰“ä¸‹åšå®åŸºç¡€ã€‚
                            æˆ‘ä»¬ç›¸ä¿¡ï¼Œæ•°å­¦ä¸åº”è¯¥æ˜¯è´Ÿæ‹…ï¼Œè€Œåº”è¯¥æ˜¯æ¢ç´¢ä¸–ç•Œçš„å·¥å…·ï¼
                        </p>
                    </div>
                </div>
            </div>

            <!-- è”ç³»æˆ‘ä»¬ -->
            <div id="contact" class="page-content">
                <div class="learning-section fade-in">
                    <div class="section-header">
                        <h2 class="section-title">ğŸ“§ è”ç³»æˆ‘ä»¬</h2>
                    </div>
                    
                    <div class="contact-form">
                        <form id="contactForm">
                            <div class="form-group">
                                <label>å§“å *</label>
                                <input type="text" class="form-control" id="contactName" required>
                            </div>
                            <div class="form-group">
                                <label>è”ç³»æ–¹å¼ *</label>
                                <input type="text" class="form-control" id="contactContact" placeholder="é‚®ç®±æˆ–æ‰‹æœºå·" required>
                            </div>
                            <div class="form-group">
                                <label>é—®é¢˜æè¿° *</label>
                                <textarea class="form-control" id="contactMessage" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„é—®é¢˜æˆ–å»ºè®®..." required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">
                                æäº¤åé¦ˆ
                            </button>
                        </form>
                        
                        <div style="margin-top: 30px; text-align: center; color: var(--text-regular);">
                            <p>ğŸ“§ é‚®ç®±ï¼šsupport@mathmaster.com</p>
                            <p>ğŸ“± ç”µè¯ï¼š400-123-4567</p>
                            <p>ğŸ• å·¥ä½œæ—¶é—´ï¼šå‘¨ä¸€è‡³å‘¨äº” 9:00-18:00</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å¿«é€Ÿç™»å½•æŒ‰é’®äº‹ä»¶å¤„ç†
        document.getElementById('quickLoginBtn').addEventListener('click', async function() {
            try {
                const result = await fetchWithToken('/api/login', {
                    method: 'POST',
                    body: JSON.stringify({ username: 'demo', password: 'demo' })
                });
                
                // å­˜å‚¨tokenå¹¶æ›´æ–°UI
                localStorage.setItem('token', result.token);
                
                document.getElementById('loginPage').classList.remove('active');
                document.getElementById('mainApp').classList.add('active');
                
                loadUserProgress();
                loadNotes();
                
                showNotification('æ¬¢è¿ä½¿ç”¨æ•°å­¦å­¦ä¹ ç½‘ç«™ï¼', 'success');
            } catch (error) {
                showNotification('ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        });
        
        // åˆ‡æ¢ç™»å½•/æ³¨å†Œè¡¨å•
        document.getElementById('switchToRegisterBtn').addEventListener('click', function() {
            document.getElementById('loginCard').style.display = 'none';
            document.getElementById('registerCard').style.display = 'block';
        });
        
        document.getElementById('switchToLoginBtn').addEventListener('click', function() {
            document.getElementById('registerCard').style.display = 'none';
            document.getElementById('loginCard').style.display = 'block';
        });
        
        // æ³¨å†ŒåŠŸèƒ½
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const passwordConfirm = document.getElementById('regPasswordConfirm').value;
            const name = document.getElementById('regName').value.trim();
            const grade = document.getElementById('regGrade').value;
            const specialty = document.getElementById('regSpecialty').value.trim();
            const learningGoal = document.getElementById('regLearningGoal').value.trim();
            const challengeDirection = document.getElementById('regChallengeDirection').value.trim();
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            if (!username) {
                showNotification('è¯·è¾“å…¥ç”¨æˆ·å', 'error');
                return;
            }
            
            if (!password) {
                showNotification('è¯·è¾“å…¥å¯†ç ', 'error');
                return;
            }
            
            // éªŒè¯å¯†ç é•¿åº¦
            if (password.length < 6) {
                showNotification('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä¸ªå­—ç¬¦', 'error');
                return;
            }
            
            // éªŒè¯ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´
            if (password !== passwordConfirm) {
                showNotification('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }
            
            // æäº¤æ³¨å†Œè¯·æ±‚
            fetchWithToken('/api/register', {
                method: 'POST',
                body: JSON.stringify({
                    username,
                    password,
                    name: name || undefined,
                    grade: grade || undefined,
                    specialty: specialty || undefined,
                    learning_goal: learningGoal || undefined,
                    challenge_direction: challengeDirection || undefined
                })
            }).then(data => {
                console.log('æ³¨å†Œå“åº”:', data);
                if (data.token) {
                    // å­˜å‚¨token
                    localStorage.setItem('token', data.token);
                    // å…ˆåˆ‡æ¢é¡µé¢ï¼Œç¡®ä¿DOMå…ƒç´ å¯ç”¨
                    document.getElementById('loginPage').classList.remove('active');
                    document.getElementById('mainApp').classList.add('active');
                    // ä½¿ç”¨ setTimeout ç¡®ä¿ DOM å·²æ›´æ–°åå†æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                    setTimeout(() => {
                        updateUserInfo(data.user);
                        // åŠ è½½ç”¨æˆ·æ•°æ®
                        loadUserProgress();
                        loadNotes();
                    }, 0);
                    showNotification('æ³¨å†ŒæˆåŠŸï¼æ¬¢è¿æ¥åˆ° MathMaster', 'success');
                } else {
                    showNotification(data.error || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼', 'error');
                }
            })
            .catch(error => {
                console.error('æ³¨å†Œé”™è¯¯:', error);
                showNotification('æ³¨å†Œå¤±è´¥: ' + (error.message || 'è¯·ç¨åé‡è¯•ï¼'), 'error');
            });
        });
        
        // ç™»å½•åŠŸèƒ½ - ä¿®æ”¹ä¸ºä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            
            // ç®€åŒ–çš„éªŒè¯ï¼Œåªæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å¡«å†™
            if (!username) {
                showNotification('è¯·è¾“å…¥ç”¨æˆ·å', 'error');
                return;
            }
            
            // ä½¿ç”¨çœŸå®åç«¯APIç™»å½•
            const password = document.getElementById('password').value;
            // åªæœ‰demoç”¨æˆ·æ‰å…è®¸ç©ºå¯†ç ï¼Œå…¶ä»–ç”¨æˆ·å¿…é¡»è¾“å…¥å¯†ç 
            const loginPassword = (username === 'demo' && !password) ? 'demo' : password;
            fetchWithToken('/api/login', {
                method: 'POST',
                body: JSON.stringify({ username, password: loginPassword })
            }).then(data => {
                console.log('ç™»å½•å“åº”:', data);
                if (data.token) {
                    // å­˜å‚¨token
                    localStorage.setItem('token', data.token);
                    // å…ˆåˆ‡æ¢é¡µé¢ï¼Œç¡®ä¿DOMå…ƒç´ å¯ç”¨
                    document.getElementById('loginPage').classList.remove('active');
                    document.getElementById('mainApp').classList.add('active');
                    // ä½¿ç”¨ setTimeout ç¡®ä¿ DOM å·²æ›´æ–°åå†æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                    setTimeout(() => {
                        updateUserInfo(data.user);
                        // åŠ è½½ç”¨æˆ·æ•°æ®
                        loadUserProgress();
                        loadNotes();
                    }, 0);
                    showNotification('ç™»å½•æˆåŠŸï¼æ¬¢è¿æ¥åˆ° MathMaster', 'success');
                } else {
                    showNotification(data.error || data.message || 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼', 'error');
                }
            })
            .catch(error => {
                console.error('ç™»å½•é”™è¯¯:', error);
                showNotification('ç™»å½•å¤±è´¥: ' + (error.message || 'è¯·ç¨åé‡è¯•ï¼'), 'error');
            });
        });
        
        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        function updateUserInfo(user) {
            // æ£€æŸ¥userå‚æ•°æ˜¯å¦å­˜åœ¨
            if (!user) {
                console.warn('updateUserInfo: userå‚æ•°ä¸ºç©º');
                return;
            }
            
            try {
                const userNameEl = document.getElementById('userName');
                const userGradeEl = document.getElementById('userGrade');
                const userSpecialtyEl = document.getElementById('userSpecialty');
                const userGoalEl = document.getElementById('userGoal');
                const userChallengeEl = document.getElementById('userChallenge');
                
                if (userNameEl) userNameEl.textContent = user.name || user.username || 'ç”¨æˆ·';
                if (userGradeEl) userGradeEl.textContent = user.grade || 'æœªè®¾ç½®';
                if (userSpecialtyEl) userSpecialtyEl.textContent = user.specialty || 'æœªè®¾ç½®';
                if (userGoalEl) userGoalEl.textContent = user.learning_goal || 'æœªè®¾ç½®';
                if (userChallengeEl) userChallengeEl.textContent = user.challenge_direction || 'æœªè®¾ç½®';
                
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                const stats = user.statistics || {};
                const completedLevelsEl = document.getElementById('completedLevels');
                const notesCountEl = document.getElementById('notesCount');
                const consecutiveDaysEl = document.getElementById('consecutiveDays');
                const pointsEl = document.getElementById('points');
                
                if (completedLevelsEl) completedLevelsEl.textContent = stats.completed_levels || 0;
                if (notesCountEl) notesCountEl.textContent = stats.notes_count || 0;
                if (consecutiveDaysEl) consecutiveDaysEl.textContent = stats.consecutive_days || 0;
                if (pointsEl) pointsEl.textContent = stats.points || 0;
            } catch (error) {
                console.error('updateUserInfoé”™è¯¯:', error);
                // ä¸æŠ›å‡ºé”™è¯¯ï¼Œé¿å…å½±å“ç™»å½•æµç¨‹
            }
        }
        
        // æ¨¡æ‹ŸAPIå“åº”çš„é™æ€æ•°æ®
        const mockData = {
            user: {
                id: 1,
                username: 'demo',
                name: 'æ•°å­¦å°è¾¾äºº',
                grade: 'é«˜äºŒ',
                specialty: 'å‡½æ•°ä¸å¯¼æ•°',
                learning_goal: 'å†²å‡»é«˜è€ƒæ•°å­¦145+',
                challenge_direction: 'å‡½æ•°ç»¼åˆé¢˜ã€å¯¼æ•°åº”ç”¨',
                statistics: {
                    completed_levels: 12,
                    notes_count: 8,
                    consecutive_days: 15,
                    points: 380
                }
            },
            progress: {
                'å‡½æ•°çš„å¥¥ç§˜': [{level: 1, completed: true}, {level: 2, completed: true}, {level: 3, completed: true}, {level: 4, completed: false}, {level: 5, completed: false}, {level: 6, completed: false}],
                'æŒ‡æ•°ä¸å¯¹æ•°': [{level: 1, completed: true}, {level: 2, completed: true}, {level: 3, completed: false}, {level: 4, completed: false}, {level: 5, completed: false}, {level: 6, completed: false}],
                'ä¸‰è§’å‡½æ•°': [{level: 1, completed: true}, {level: 2, completed: false}, {level: 3, completed: false}, {level: 4, completed: false}, {level: 5, completed: false}, {level: 6, completed: false}],
                'æ•°åˆ—ä¸æ±‚å’Œ': [{level: 1, completed: true}, {level: 2, completed: false}, {level: 3, completed: false}, {level: 4, completed: false}, {level: 5, completed: false}, {level: 6, completed: false}],
                'å¯¼æ•°åˆæ¢': [{level: 1, completed: false}, {level: 2, completed: false}, {level: 3, completed: false}, {level: 4, completed: false}, {level: 5, completed: false}, {level: 6, completed: false}],
                'æ¦‚ç‡ç»Ÿè®¡': [{level: 1, completed: false}, {level: 2, completed: false}, {level: 3, completed: false}, {level: 4, completed: false}, {level: 5, completed: false}, {level: 6, completed: false}]
            },
            notes: [
                {
                    id: 1,
                    title: 'å‡½æ•°å®šä¹‰åŸŸçš„ç†è§£æŠ€å·§',
                    content: 'æ±‚å‡½æ•°å®šä¹‰åŸŸè¦è®°ä½ä¸‰è¦ç´ ï¼šæ ¹å·å†…éè´Ÿã€åˆ†æ¯ä¸ä¸ºé›¶ã€å¯¹æ•°çœŸæ•°å¤§äºé›¶ã€‚å»ºè®®ç”»ä¸ªæ•°è½´å¸®åŠ©ç†è§£ï¼ç‰¹åˆ«æ˜¯å¤åˆå‡½æ•°çš„å®šä¹‰åŸŸï¼Œè¦ä»å†…å‘å¤–é€å±‚åˆ†æã€‚æ¯”å¦‚æ±‚f(x)=âˆš(x-2)/(x-3)çš„å®šä¹‰åŸŸï¼Œéœ€è¦åŒæ—¶æ»¡è¶³x-2â‰¥0å’Œx-3â‰ 0ã€‚',
                    type: 'å…¥é—¨å¿ƒå¾—',
                    likes: 25,
                    comments_count: 8,
                    name: 'æ•°å­¦å°è¾¾äºº'
                },
                {
                    id: 2,
                    title: 'ä¸‰è§’å‡½æ•°å›¾åƒå˜æ¢è®°å¿†å£è¯€',
                    content: 'å·¦åŠ å³å‡å¯¹è‡ªå˜é‡ï¼Œä¸ŠåŠ ä¸‹å‡å¯¹æ•´ä½“ã€‚å‘¨æœŸå˜æ¢çœ‹Ï‰ï¼Œå€¼åŸŸå˜åŒ–çœ‹Aå’Œkã€‚è¿™ä¸ªå£è¯€å¸®æˆ‘è®°ä½äº†æ‰€æœ‰å˜æ¢è§„åˆ™ï¼æ¯”å¦‚y=2sin(3x-Ï€/2)+1ï¼Œå¯ä»¥åˆ†è§£ä¸ºï¼šæŒ¯å¹…2ï¼Œå‘¨æœŸ2Ï€/3ï¼Œç›¸ä½å·¦ç§»Ï€/6ï¼Œä¸Šç§»1ä¸ªå•ä½ã€‚',
                    type: 'è¿›é˜¶å¿ƒå¾—',
                    likes: 42,
                    comments_count: 15,
                    name: 'æ•°å­¦å°è¾¾äºº'
                },
                {
                    id: 3,
                    title: 'è£‚é¡¹ç›¸æ¶ˆæ³•çš„è¿›é˜¶åº”ç”¨',
                    content: 'é‡åˆ°1/(n(n+1))å½¢å¼çš„æ•°åˆ—ï¼Œç”¨è£‚é¡¹ç›¸æ¶ˆã€‚ä½†æ›´å¤æ‚çš„å¦‚1/(n(n+2))éœ€è¦æ‹†æˆ1/2Ã—(1/n - 1/(n+2))ï¼Œè¿™ä¸ªæŠ€å·§åœ¨å‹è½´é¢˜ä¸­å¾ˆå®ç”¨ï¼å…³é”®æ˜¯æ‰¾åˆ°åˆé€‚çš„åˆ†æ‹†æ–¹å¼ï¼Œè®©ä¸­é—´é¡¹èƒ½å¤Ÿç›¸äº’æŠµæ¶ˆã€‚',
                    type: 'æŒ‘æˆ˜å¿ƒå¾—',
                    likes: 68,
                    comments_count: 23,
                    name: 'æ•°å­¦å°è¾¾äºº'
                },
                {
                    id: 4,
                    title: 'å¯¼æ•°åœ¨ç”Ÿæ´»ä¸­çš„åº”ç”¨',
                    content: 'å¯¼æ•°å…¶å®å°±æ˜¯ç¬æ—¶å˜åŒ–ç‡ã€‚æ¯”å¦‚æ±½è½¦é€Ÿåº¦è¡¨æ˜¾ç¤ºçš„å°±æ˜¯ä½ç§»å¯¹æ—¶é—´çš„å¯¼æ•°ã€‚ç»æµå­¦ä¸­çš„è¾¹é™…æˆæœ¬ã€è¾¹é™…æ”¶ç›Šä¹Ÿæ˜¯å¯¼æ•°çš„åº”ç”¨ã€‚ç†è§£äº†è¿™ä¸€ç‚¹ï¼ŒæŠ½è±¡çš„å¯¼æ•°æ¦‚å¿µå°±å˜å¾—å…·ä½“äº†ï¼',
                    type: 'è¿›é˜¶å¿ƒå¾—',
                    likes: 35,
                    comments_count: 12,
                    name: 'æ•°å­¦å°è¾¾äºº'
                }
            ]
        };
        
        // æ¨¡æ‹ŸAPIè¯·æ±‚å‡½æ•°
        // è¿æ¥åˆ°çœŸå®Flaskåç«¯API
        async function fetchWithToken(url, options = {}) {
            // åç«¯APIåŸºç¡€URL - è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
            // å¦‚æœæ˜¯æœ¬åœ°å¼€å‘ï¼Œä½¿ç”¨ localhostï¼›å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–ç¯å¢ƒå˜é‡
            const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
                ? 'http://localhost:3001' 
                : ''; // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œä¸å‰ç«¯åŒåŸŸ
            const fullUrl = API_BASE_URL + url;

            // è®¾ç½®é»˜è®¤é€‰é¡¹
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json'
                }
            };

            // å¦‚æœä¸æ˜¯ç™»å½•æˆ–æ³¨å†Œè¯·æ±‚ï¼Œæ·»åŠ è®¤è¯token
            if (url !== '/api/login' && url !== '/api/register') {
                const token = localStorage.getItem('token');
                if (token) {
                    defaultOptions.headers.Authorization = `Bearer ${token}`;
                }
            }

            // åˆå¹¶é€‰é¡¹
            const mergedOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            };

            try {
                // å‘é€çœŸå®çš„APIè¯·æ±‚
                const response = await fetch(fullUrl, mergedOptions);
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMsg = errorData.error || `HTTPé”™è¯¯ ${response.status}`;
                    console.error('APIé”™è¯¯å“åº”:', response.status, errorData);
                    throw new Error(errorMsg);
                }
                
                // è§£æJSONå“åº”
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('APIè¯·æ±‚é”™è¯¯:', error);
                console.error('è¯·æ±‚URL:', fullUrl);
                console.error('è¯·æ±‚é€‰é¡¹:', mergedOptions);
                // ä¸åœ¨è¿™é‡Œæ˜¾ç¤ºé”™è¯¯é€šçŸ¥ï¼Œè®©è°ƒç”¨è€…å¤„ç†
                throw error;
            }
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(pageId, eventElement) {
            // éšè—æ‰€æœ‰é¡µé¢å†…å®¹
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„é¡µé¢
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // æ›´æ–°å¯¼èˆªæ æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // å¦‚æœæä¾›äº†äº‹ä»¶å…ƒç´ ï¼Œæ›´æ–°å…¶æ¿€æ´»çŠ¶æ€
            if (eventElement) {
                eventElement.classList.add('active');
            } else if (window.event && window.event.target) {
                window.event.target.classList.add('active');
            }
        }


        // å½“å‰ä¸»é¢˜å’Œå…³å¡çŠ¶æ€
        let currentTheme = null;
        let currentLevel = null;

        // å¼€å§‹ä¸»é¢˜å­¦ä¹ 
        function startTheme(themeName) {
            currentTheme = themeName;
            showThemeDetailPage(themeName);
        }

        // æ˜¾ç¤ºä¸»é¢˜è¯¦æƒ…é¡µé¢
        function showThemeDetailPage(themeName) {
            const details = {
                'å‡½æ•°çš„å¥¥ç§˜': {
                    icon: 'ğŸ¡',
                    description: 'é€šè¿‡æ¸¸ä¹å›­æ‘©å¤©è½®çš„è¿åŠ¨è½¨è¿¹ï¼Œç†è§£å‡½æ•°è¾“å…¥ä¸è¾“å‡ºçš„å…³ç³»ï¼Œæ„Ÿå—æ•°å­¦æè¿°ç°å®ä¸–ç•Œçš„ç¾å¦™ã€‚',
                    concepts: ['å®šä¹‰åŸŸä¸å€¼åŸŸ', 'å‡½æ•°çš„è¡¨ç¤ºæ–¹æ³•', 'å‡½æ•°çš„å•è°ƒæ€§', 'å‡½æ•°çš„å¥‡å¶æ€§'],
                    example: 'æ‘©å¤©è½®é«˜åº¦ h(t) = 20sin(Ï€t/10) + 35',
                    levels: 6
                },
                'æŒ‡æ•°ä¸å¯¹æ•°': {
                    icon: 'ğŸ§¬',
                    description: 'è§‚å¯Ÿç”Ÿç‰©ç»†èƒåˆ†è£‚è¿‡ç¨‹ï¼Œä½“éªŒæŒ‡æ•°çˆ†ç‚¸å¼å¢é•¿ï¼Œç†è§£æŒ‡æ•°å‡½æ•°çš„å¨åŠ›ä¸å¯¹æ•°çš„è¿ç®—è§„å¾‹ã€‚',
                    concepts: ['æŒ‡æ•°å‡½æ•°çš„æ€§è´¨', 'å¯¹æ•°è¿ç®—è§„åˆ™', 'æŒ‡æ•°ä¸å¯¹æ•°çš„å…³ç³»', 'å®é™…åº”ç”¨é—®é¢˜'],
                    example: 'ç»†èƒåˆ†è£‚ï¼šN(t) = Nâ‚€ Ã— 2^t',
                    levels: 6
                },
                'ä¸‰è§’å‡½æ•°': {
                    icon: 'ğŸŒŠ',
                    description: 'é€šè¿‡æµ·æ´‹æ½®æ±çš„å‘¨æœŸæ€§æ¶¨è½ï¼ŒæŒæ¡ä¸‰è§’å‡½æ•°çš„å‘¨æœŸç‰¹æ€§ï¼Œç†è§£æ­£å¼¦ä½™å¼¦çš„æ³¢åŠ¨è§„å¾‹ã€‚',
                    concepts: ['ä»»æ„è§’ä¸å¼§åº¦åˆ¶', 'ä¸‰è§’å‡½æ•°çš„å®šä¹‰', 'è¯±å¯¼å…¬å¼', 'ä¸‰è§’å‡½æ•°çš„å›¾åƒä¸æ€§è´¨'],
                    example: 'æ½®æ±é«˜åº¦ï¼šh(t) = 2sin(Ï€t/6) + 3',
                    levels: 6
                },
                'æ•°åˆ—ä¸æ±‚å’Œ': {
                    icon: 'ğŸ’°',
                    description: 'é€šè¿‡ç†è´¢æŠ•èµ„çš„å¤åˆ©è®¡ç®—ï¼Œä½“ä¼šæ•°åˆ—é€’æ¨ä¸æ±‚å’Œçš„å®é™…åº”ç”¨ï¼ŒæŒæ¡æ•°å­¦å»ºæ¨¡æ€ç»´ã€‚',
                    concepts: ['ç­‰å·®æ•°åˆ—', 'ç­‰æ¯”æ•°åˆ—', 'æ•°åˆ—æ±‚å’Œæ–¹æ³•', 'é€’æ¨æ•°åˆ—'],
                    example: 'å¤åˆ©è®¡ç®—ï¼šA = P(1 + r)^n',
                    levels: 6
                },
                'å¯¼æ•°åˆæ¢': {
                    icon: 'ğŸš—',
                    description: 'åˆ†ææ±½è½¦ä»é™æ­¢åˆ°é«˜é€Ÿçš„åŠ é€Ÿæ›²çº¿ï¼Œç†è§£å¯¼æ•°æè¿°å˜åŒ–ç‡çš„æœ¬è´¨ï¼ŒæŒæ¡å¾®ç§¯åˆ†åŸºç¡€ã€‚',
                    concepts: ['å¯¼æ•°çš„å®šä¹‰', 'å¯¼æ•°çš„å‡ ä½•æ„ä¹‰', 'åŸºæœ¬æ±‚å¯¼å…¬å¼', 'å¯¼æ•°çš„åº”ç”¨'],
                    example: 'ç¬æ—¶é€Ÿåº¦ï¼šv = ds/dt',
                    levels: 6
                },
                'æ¦‚ç‡ç»Ÿè®¡': {
                    icon: 'ğŸ²',
                    description: 'é€šè¿‡æ—¥å¸¸æŠ½å¥–æ¸¸æˆï¼Œç†è§£æ¦‚ç‡ç»Ÿè®¡çš„åŸºæœ¬æ¦‚å¿µï¼Œå­¦ä¼šç”¨æ•°å­¦æ€ç»´åˆ†æéšæœºäº‹ä»¶ã€‚',
                    concepts: ['éšæœºäº‹ä»¶', 'æ¦‚ç‡çš„è®¡ç®—', 'ç»Ÿè®¡å›¾è¡¨', 'ç»Ÿè®¡é‡åˆ†æ'],
                    example: 'æŠ½å¥–æ¦‚ç‡ï¼šP = æœ‰åˆ©äº‹ä»¶æ•° / æ€»äº‹ä»¶æ•°',
                    levels: 6
                }
            };
            
            const detail = details[themeName];
            if (!detail) return;

            // è·å–ç”¨æˆ·è¿›åº¦
            fetchWithToken('/api/progress')
                .then(progress => {
                    const themeProgress = progress[themeName] || [];
                    
                    document.getElementById('themeDetailTitle').textContent = `${detail.icon} ${themeName}`;
                    const content = document.getElementById('themeDetailContent');
                    
                    let levelsHtml = '<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px;">';
                    for (let i = 1; i <= detail.levels; i++) {
                        const levelData = themeProgress.find(l => l.level === i);
                        const isCompleted = levelData && levelData.completed;
                        levelsHtml += `
                            <div class="theme-card" style="cursor: pointer;" onclick="showLevelDetail('${themeName}', ${i})">
                                <div class="theme-icon">${isCompleted ? 'âœ“' : i}</div>
                                <h3>ç¬¬ ${i} å…³${isCompleted ? ' (å·²å®Œæˆ)' : ''}</h3>
                                <p>ç‚¹å‡»å¼€å§‹å­¦ä¹ ç¬¬ ${i} å…³çš„å†…å®¹</p>
                                <button class="btn btn-primary">${isCompleted ? 'å¤ä¹ ' : 'å¼€å§‹'}</button>
                            </div>
                        `;
                    }
                    levelsHtml += '</div>';

                    content.innerHTML = `
                        <div style="background: var(--background-color); border-radius: 15px; padding: 30px; margin-bottom: 20px;">
                            <h3 style="margin-bottom: 15px;">ğŸ“– ä¸»é¢˜ä»‹ç»</h3>
                            <p style="line-height: 1.8; color: var(--text-regular); margin-bottom: 20px;">${detail.description}</p>
                            
                            <h3 style="margin-top: 25px; margin-bottom: 15px;">ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h3>
                            <ul style="line-height: 2; color: var(--text-regular); margin-left: 20px;">
                                ${detail.concepts.map(c => `<li>${c}</li>`).join('')}
                            </ul>
                            
                            <h3 style="margin-top: 25px; margin-bottom: 15px;">ğŸŒŸ ç”Ÿæ´»å®ä¾‹</h3>
                            <p style="line-height: 1.8; color: var(--text-regular); background: white; padding: 15px; border-radius: 8px; font-family: monospace;">
                                ${detail.example}
                            </p>
                        </div>
                        <h3 style="margin-bottom: 20px;">ğŸ¯ å…³å¡åˆ—è¡¨</h3>
                        ${levelsHtml}
                    `;
                    
                    showPage('themeDetail', null);
                })
                .catch(error => {
                    console.error('åŠ è½½è¿›åº¦å¤±è´¥:', error);
                });
        }

        // æ˜¾ç¤ºå…³å¡è¯¦æƒ…
        function showLevelDetail(themeName, level) {
            currentTheme = themeName;
            currentLevel = level;
            
            const levelContents = {
                'å‡½æ•°çš„å¥¥ç§˜': {
                    1: { title: 'å‡½æ•°çš„å®šä¹‰', content: 'ç†è§£å‡½æ•°çš„æ¦‚å¿µï¼šå¯¹äºé›†åˆAä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ xï¼Œåœ¨é›†åˆBä¸­éƒ½æœ‰å”¯ä¸€ç¡®å®šçš„å…ƒç´ yä¸ä¹‹å¯¹åº”ã€‚', question: 'å‡½æ•°f(x) = xÂ²çš„å®šä¹‰åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ', answer: 'æ‰€æœ‰å®æ•°' },
                    2: { title: 'å®šä¹‰åŸŸä¸å€¼åŸŸ', content: 'å®šä¹‰åŸŸæ˜¯å‡½æ•°è‡ªå˜é‡çš„å–å€¼èŒƒå›´ï¼Œå€¼åŸŸæ˜¯å‡½æ•°å› å˜é‡çš„å–å€¼èŒƒå›´ã€‚', question: 'å‡½æ•°f(x) = âˆš(x-2)çš„å®šä¹‰åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ', answer: '[2, +âˆ)' },
                    3: { title: 'å‡½æ•°çš„è¡¨ç¤ºæ–¹æ³•', content: 'å‡½æ•°å¯ä»¥ç”¨è§£æå¼ã€å›¾åƒã€è¡¨æ ¼ä¸‰ç§æ–¹å¼è¡¨ç¤ºã€‚', question: 'å‡½æ•°y = 2x + 1çš„å›¾åƒæ˜¯ä»€ä¹ˆï¼Ÿ', answer: 'ä¸€æ¡æ–œç‡ä¸º2çš„ç›´çº¿' },
                    4: { title: 'å‡½æ•°çš„å•è°ƒæ€§', content: 'å‡½æ•°åœ¨æŸä¸ªåŒºé—´å†…ï¼Œå¦‚æœxâ‚ < xâ‚‚æ—¶f(xâ‚) < f(xâ‚‚)ï¼Œåˆ™å‡½æ•°åœ¨è¯¥åŒºé—´å†…å•è°ƒé€’å¢ã€‚', question: 'å‡½æ•°f(x) = xÂ²åœ¨(0, +âˆ)ä¸Šçš„å•è°ƒæ€§ï¼Ÿ', answer: 'å•è°ƒé€’å¢' },
                    5: { title: 'å‡½æ•°çš„å¥‡å¶æ€§', content: 'å¦‚æœf(-x) = f(x)ï¼Œåˆ™å‡½æ•°ä¸ºå¶å‡½æ•°ï¼›å¦‚æœf(-x) = -f(x)ï¼Œåˆ™å‡½æ•°ä¸ºå¥‡å‡½æ•°ã€‚', question: 'å‡½æ•°f(x) = xÂ³çš„å¥‡å¶æ€§ï¼Ÿ', answer: 'å¥‡å‡½æ•°' },
                    6: { title: 'å‡½æ•°çš„ç»¼åˆåº”ç”¨', content: 'ç»¼åˆè¿ç”¨å‡½æ•°çš„å„ç§æ€§è´¨è§£å†³å®é™…é—®é¢˜ã€‚', question: 'æ‘©å¤©è½®é«˜åº¦å‡½æ•°h(t) = 20sin(Ï€t/10) + 35çš„å‘¨æœŸæ˜¯å¤šå°‘ï¼Ÿ', answer: '20ç§’' }
                }
            };

            const levelData = levelContents[themeName]?.[level] || {
                title: `ç¬¬ ${level} å…³`,
                content: `è¿™æ˜¯${themeName}ä¸»é¢˜çš„ç¬¬${level}å…³å†…å®¹ã€‚`,
                question: 'è¯·å®Œæˆæœ¬å…³çš„å­¦ä¹ ä»»åŠ¡ã€‚',
                answer: 'å®Œæˆ'
            };

            document.getElementById('levelDetailTitle').textContent = `${themeName} - ${levelData.title}`;
            const content = document.getElementById('levelDetailContent');
            
            content.innerHTML = `
                <div style="background: var(--background-color); border-radius: 15px; padding: 30px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">ğŸ“š å­¦ä¹ å†…å®¹</h3>
                    <p style="line-height: 1.8; color: var(--text-regular); margin-bottom: 20px;">${levelData.content}</p>
                </div>
                
                <div style="background: var(--background-color); border-radius: 15px; padding: 30px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px;">â“ æ€è€ƒé¢˜</h3>
                    <p style="line-height: 1.8; color: var(--text-regular); margin-bottom: 20px; font-weight: bold;">${levelData.question}</p>
                    <details style="margin-top: 15px;">
                        <summary style="cursor: pointer; color: var(--primary-color); font-weight: 500;">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</summary>
                        <p style="margin-top: 10px; padding: 15px; background: white; border-radius: 8px; color: var(--text-regular);">${levelData.answer}</p>
                    </details>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="completeCurrentLevel()" style="padding: 15px 40px; font-size: 16px;">
                        âœ“ å®Œæˆæœ¬å…³
                    </button>
                </div>
            `;
            
            showPage('levelDetail', null);
        }

        // å®Œæˆå½“å‰å…³å¡
        function completeCurrentLevel() {
            if (!currentTheme || !currentLevel) return;
            
            completeLevel(currentTheme, currentLevel.toString(), null);
            setTimeout(() => {
                showThemeDetailPage(currentTheme);
            }, 1000);
        }

        // ä»å…³å¡è¯¦æƒ…è¿”å›
        function goBackFromLevel() {
            if (currentTheme) {
                showThemeDetailPage(currentTheme);
            } else {
                showPage('contextLearning', null);
            }
        }

        // æ¯æ—¥æ‰“å¡
        function doCheckIn() {
            fetchWithToken('/api/checkin', {
                method: 'POST'
            })
            .then(data => {
                showNotification(data.message || 'æ‰“å¡æˆåŠŸï¼', 'success');
                updateUserStats();
            })
            .catch(error => {
                console.error('æ‰“å¡å¤±è´¥:', error);
                showNotification('æ‰“å¡å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            });
        }

        // è”ç³»è¡¨å•æäº¤
        document.getElementById('contactForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('contactName').value;
            const contact = document.getElementById('contactContact').value;
            const message = document.getElementById('contactMessage').value;
            
            // å‘é€åˆ°åç«¯API
            fetchWithToken('/api/contact', {
                method: 'POST',
                body: JSON.stringify({ name, contact, message })
            })
            .then(data => {
                showNotification(data.message || 'åé¦ˆæäº¤æˆåŠŸï¼æˆ‘ä»¬ä¼šå°½å¿«å›å¤æ‚¨ã€‚', 'success');
                this.reset();
            })
            .catch(error => {
                console.error('æäº¤åé¦ˆå¤±è´¥:', error);
                showNotification('æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼', 'error');
            });
        });
        
        // åŠ è½½ç”¨æˆ·å­¦ä¹ è¿›åº¦
        function loadUserProgress() {
            fetchWithToken('/api/progress')
                .then(progress => {
                    updateProgressDisplay(progress);
                })
                .catch(error => {
                    console.error('åŠ è½½è¿›åº¦å¤±è´¥:', error);
                });
        }
        
        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgressDisplay(progress) {
            // æ›´æ–°è¿›åº¦æ¡å’Œå…³å¡çŠ¶æ€
            for (const theme in progress) {
                const levels = progress[theme];
                levels.forEach(level => {
                    const levelElement = document.querySelector(`.level-item[data-theme="${theme}"][data-level="${level.level}"]`);
                    if (levelElement) {
                        if (level.completed) {
                            levelElement.classList.add('completed');
                            levelElement.innerHTML = `<span>${level.level}</span> âœ“`;
                        }
                    }
                });
            }
        }
        
        // åˆ†é¡µç›¸å…³å˜é‡
        let currentNotesPage = 1;
        const notesPerPage = 3;
        let allNotes = [];

        // åŠ è½½å¿ƒå¾—åˆ—è¡¨
        function loadNotes() {
            fetchWithToken('/api/notes')
                .then(notes => {
                    allNotes = notes;
                    currentNotesPage = 1;
                    renderNotesList();
                })
                .catch(error => {
                    console.error('åŠ è½½å¿ƒå¾—å¤±è´¥:', error);
                });
        }
        
        // æ¸²æŸ“å¿ƒå¾—åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µï¼‰
        function renderNotesList() {
            const notesContainer = document.getElementById('notesList');
            if (!notesContainer) return;

            const startIndex = (currentNotesPage - 1) * notesPerPage;
            const endIndex = startIndex + notesPerPage;
            const currentPageNotes = allNotes.slice(startIndex, endIndex);
            const totalPages = Math.ceil(allNotes.length / notesPerPage);

            notesContainer.innerHTML = '';
            
            if (currentPageNotes.length === 0) {
                notesContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">æš‚æ— å¿ƒå¾—</p>';
            } else {
                currentPageNotes.forEach(note => {
                    const noteCard = document.createElement('div');
                    noteCard.className = 'note-card fade-in';
                    const typeClass = note.type === 'å…¥é—¨å¿ƒå¾—' ? 'type-basic' : 
                                     note.type === 'è¿›é˜¶å¿ƒå¾—' ? 'type-advanced' : 'type-challenge';
                    noteCard.innerHTML = `
                        <div class="note-header">
                            <h3 class="note-title">${note.title}</h3>
                            <span class="note-type ${typeClass}">${note.type}</span>
                        </div>
                        <p class="note-content">${note.content}</p>
                        <div class="note-footer">
                            <div>ğŸ‘¤ ${note.name || note.username} Â· ${new Date(note.createdAt).toLocaleDateString()}</div>
                            <div class="note-actions">
                                <span onclick="likeNote(${note.id})" style="cursor: pointer;">ğŸ‘ ${note.likes}</span>
                                <span>ğŸ’¬ ${note.comments_count}</span>
                                <span>â­ æ”¶è—</span>
                            </div>
                        </div>
                    `;
                    notesContainer.appendChild(noteCard);
                });
            }

            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            document.getElementById('pageInfo').textContent = `ç¬¬ ${currentNotesPage} é¡µï¼Œå…± ${totalPages} é¡µ`;
            document.getElementById('prevPageBtn').disabled = currentNotesPage === 1;
            document.getElementById('nextPageBtn').disabled = currentNotesPage === totalPages || totalPages === 0;
        }

        // åˆ‡æ¢å¿ƒå¾—é¡µé¢
        function changeNotesPage(direction) {
            const totalPages = Math.ceil(allNotes.length / notesPerPage);
            const newPage = currentNotesPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                currentNotesPage = newPage;
                renderNotesList();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // ç‚¹èµå¿ƒå¾—
        function likeNote(noteId) {
            fetchWithToken(`/api/notes/${noteId}/like`, {
                method: 'POST'
            })
            .then(data => {
                showNotification('ç‚¹èµæˆåŠŸï¼', 'success');
                loadNotes(); // é‡æ–°åŠ è½½å¿ƒå¾—åˆ—è¡¨
            })
            .catch(error => {
                console.error('ç‚¹èµå¤±è´¥:', error);
            });
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('token');
                document.getElementById('mainApp').classList.remove('active');
                document.getElementById('loginPage').classList.add('active');
                document.getElementById('loginForm').reset();
                showNotification('å·²æˆåŠŸé€€å‡ºç™»å½•', 'info');
            }
        }

        // é€šçŸ¥åŠŸèƒ½
        function showNotification(message, type = 'info') {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? '#67c23a' : type === 'error' ? '#f56c6c' : '#909399'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = message;
            
            // æ·»åŠ åŠ¨ç”»æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // é¡µé¢åŠ è½½åŠ¨ç”»
        document.addEventListener('DOMContentLoaded', function() {
            const fadeElements = document.querySelectorAll('.fade-in');
            fadeElements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });

        // å…³å¡ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.level-item').forEach(item => {
            item.addEventListener('click', function() {
                const theme = this.getAttribute('data-theme');
                const level = this.getAttribute('data-level');
                showLevelDetail(theme, parseInt(level));
            });
        });
        
        // å®Œæˆå…³å¡
        function completeLevel(theme, level, element) {
            fetchWithToken('/api/progress/update', {
                method: 'POST',
                body: JSON.stringify({ theme, level: parseInt(level) })
            })
            .then(data => {
                showNotification('æ­å–œå®Œæˆå…³å¡ï¼è·å¾—10ç§¯åˆ†', 'success');
                if (element) {
                    element.classList.add('completed');
                    element.innerHTML = `<span>${level}</span> âœ“`;
                }
                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateUserStats();
                // æ›´æ–°è¿›åº¦æ˜¾ç¤º
                loadUserProgress();
            })
            .catch(error => {
                console.error('æ›´æ–°è¿›åº¦å¤±è´¥:', error);
            });
        }
        
        // æ›´æ–°ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
        function updateUserStats() {
            fetchWithToken('/api/user')
                .then(user => {
                    updateUserInfo(user);
                })
                .catch(error => {
                    console.error('æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                });
        }
        
        // æ¯æ—¥æ‰“å¡åŠŸèƒ½
        function checkIn() {
            fetchWithToken('/api/checkin', {
                method: 'POST'
            })
            .then(data => {
                showNotification(data.message, 'success');
                updateUserStats();
            })
            .catch(error => {
                console.error('æ‰“å¡å¤±è´¥:', error);
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
        document.addEventListener('DOMContentLoaded', function() {
            const fadeElements = document.querySelectorAll('.fade-in');
            fadeElements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, index * 100);
            });
            
            // å¦‚æœæœ‰tokenï¼Œè‡ªåŠ¨ç™»å½•
            const token = localStorage.getItem('token');
            if (token) {
                fetchWithToken('/api/user')
                    .then(user => {
                        // å…ˆåˆ‡æ¢é¡µé¢ï¼Œç¡®ä¿DOMå…ƒç´ å¯ç”¨
                        document.getElementById('loginPage').classList.remove('active');
                        document.getElementById('mainApp').classList.add('active');
                        // ä½¿ç”¨ setTimeout ç¡®ä¿ DOM å·²æ›´æ–°åå†æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                        setTimeout(() => {
                            updateUserInfo(user);
                            loadUserProgress();
                            loadNotes();
                        }, 0);
                    })
                    .catch(error => {
                        // Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ
                        localStorage.removeItem('token');
                    });
            }
        });
    </script>
</body>
</html>
