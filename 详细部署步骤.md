# 🚀 MathMaster 网站免费部署详细步骤

> 本指南将一步一步教你如何将 MathMaster 网站免费部署到 Render 平台
> 预计总时间：20-30 分钟

---

## 📋 目录

1. [准备工作](#准备工作)
2. [第一步：注册 GitHub 账号](#第一步注册-github-账号)
3. [第二步：上传代码到 GitHub](#第二步上传代码到-github)
4. [第三步：注册 Render 账号](#第三步注册-render-账号)
5. [第四步：创建 PostgreSQL 数据库](#第四步创建-postgresql-数据库)
6. [第五步：初始化数据库](#第五步初始化数据库)
7. [第六步：创建 Web 服务](#第六步创建-web-服务)
8. [第七步：配置环境变量](#第七步配置环境变量)
9. [第八步：等待部署完成](#第八步等待部署完成)
10. [常见问题解答](#常见问题解答)

---

## 准备工作

### 需要准备的东西：

✅ **邮箱账号**（用于注册 GitHub 和 Render）  
✅ **电脑**（Windows/Mac/Linux 都可以）  
✅ **网络连接**  
✅ **约 30 分钟时间**

### 不需要准备的东西：

❌ 不需要信用卡  
❌ 不需要付费  
❌ 不需要服务器  
❌ 不需要域名（Render 会提供免费域名）

---

## 第一步：注册 GitHub 账号

### 1.1 访问 GitHub

打开浏览器，访问：**https://github.com**

### 1.2 注册账号

1. 点击右上角的 **"Sign up"** 按钮
2. 填写注册信息：
   - **Username**（用户名）：选择一个用户名，例如：`yourname2024`
   - **Email**（邮箱）：输入你的邮箱地址
   - **Password**（密码）：设置一个密码（至少 8 个字符）
3. 完成人机验证（如果有）
4. 点击 **"Create account"**

### 1.3 验证邮箱

1. GitHub 会发送验证邮件到你的邮箱
2. 打开邮箱，找到 GitHub 的邮件
3. 点击邮件中的验证链接
4. 完成邮箱验证

### 1.4 完成注册

注册完成后，你会看到 GitHub 的主页。恭喜！第一步完成 ✅

---

## 第二步：上传代码到 GitHub

### 方法 A：使用 GitHub Desktop（推荐，最简单）⭐

#### 2.1 下载 GitHub Desktop

1. 访问：**https://desktop.github.com**
2. 点击 **"Download for Windows"**（或 Mac/Linux）
3. 下载完成后，双击安装文件
4. 按照提示完成安装（全部选择默认选项即可）

#### 2.2 打开并登录 GitHub Desktop

1. 打开 GitHub Desktop 软件
2. 点击 **"Sign in to GitHub.com"**
3. 在浏览器中完成登录授权
4. 返回 GitHub Desktop，应该已经登录成功

#### 2.3 添加本地项目

1. 在 GitHub Desktop 中，点击菜单栏的 **"File"**
2. 选择 **"Add Local Repository"**
3. 点击 **"Choose..."** 按钮
4. 浏览到你的项目文件夹：**`d:\999\7`**
5. 点击 **"Add"**

#### 2.4 发布到 GitHub

1. 在 GitHub Desktop 中，点击右上角的 **"Publish repository"** 按钮
2. 配置仓库信息：
   - **Name**（仓库名称）：输入 `mathmaster`（或任意名称）
   - **Description**（描述）：可选，留空也可以
   - **Keep this code private**：建议**不勾选**（公开仓库，免费部署需要）
3. 点击 **"Publish repository"**
4. 等待上传完成（可能需要 1-3 分钟）

#### 2.5 验证上传成功

1. 打开浏览器，访问：**https://github.com/你的用户名/mathmaster**
2. 如果能看到你的代码文件（如 `server.js`、`package.json` 等），说明上传成功 ✅

---

### 方法 B：使用命令行（如果你熟悉 Git）

如果你已经安装了 Git，可以使用命令行：

1. 打开 **PowerShell** 或 **CMD**
2. 进入项目文件夹：
   ```bash
   cd d:\999\7
   ```
3. 执行以下命令：
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/你的用户名/mathmaster.git
   git push -u origin main
   ```
4. 输入你的 GitHub 用户名和密码（或使用 Personal Access Token）

---

## 第三步：注册 Render 账号

### 3.1 访问 Render

打开浏览器，访问：**https://render.com**

### 3.2 注册账号

1. 点击右上角的 **"Get Started for Free"** 按钮
2. 选择 **"Continue with GitHub"**
3. 会跳转到 GitHub 授权页面
4. 点击 **"Authorize render"** 授权 Render 访问你的 GitHub
5. 完成注册

### 3.3 进入控制台

注册完成后，会自动跳转到 Render 的控制台（Dashboard）。你应该能看到类似这样的界面：

```
Dashboard
├── Services
├── Databases
└── ...
```

恭喜！第三步完成 ✅

---

## 第四步：创建 PostgreSQL 数据库

### 4.1 创建数据库

1. 在 Render 控制台，点击右上角的 **"New +"** 按钮
2. 在下拉菜单中选择 **"PostgreSQL"**

### 4.2 配置数据库

填写以下信息：

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **Name** | `mathmaster-db` | 数据库服务名称（可以自定义） |
| **Database** | `mathmaster` | 数据库名称 |
| **User** | `mathmaster` | 数据库用户名 |
| **Region** | `Singapore` | 选择离你最近的区域（或任意） |
| **PostgreSQL Version** | `Latest` | 使用最新版本 |
| **Plan** | **`Free`** | ⚠️ 重要：选择免费套餐 |

### 4.3 创建数据库

1. 确认所有配置正确
2. 点击 **"Create Database"** 按钮
3. 等待创建完成（通常需要 2-3 分钟）

### 4.4 查看数据库信息

1. 创建完成后，点击数据库名称 **"mathmaster-db"** 进入详情页
2. 找到 **"Connections"** 部分
3. 找到 **"External Database URL"**，格式类似：
   ```
   postgresql://mathmaster:密码@主机地址:5432/mathmaster
   ```
4. **重要**：复制这个 URL，稍后会用到！

### 4.5 提取数据库连接信息

从 External Database URL 中提取以下信息：

**URL 格式：**
```
postgresql://用户名:密码@主机:端口/数据库名
```

**示例：**
```
postgresql://mathmaster:abc123xyz@dpg-xxxxx.singapore-postgres.render.com:5432/mathmaster
```

**提取的信息：**

| 环境变量 | 值 | 说明 |
|---------|-----|------|
| `DB_HOST` | `dpg-xxxxx.singapore-postgres.render.com` | @ 和 : 之间的部分 |
| `DB_USER` | `mathmaster` | 第一个 : 之前的部分 |
| `DB_PASSWORD` | `abc123xyz` | 第一个 : 和 @ 之间的部分 |
| `DB_NAME` | `mathmaster` | 最后一个 / 之后的部分 |
| `DB_PORT` | `5432` | 通常是 5432 |

**📝 请把这些信息记下来，稍后配置 Web 服务时会用到！**

恭喜！第四步完成 ✅

---

## 第五步：初始化数据库

### 5.1 打开数据库 Web Shell

1. 在数据库详情页，找到 **"Connect"** 部分
2. 点击 **"psql"** 标签
3. 会显示一个连接命令，类似：
   ```
   psql postgresql://mathmaster:密码@主机:5432/mathmaster
   ```
4. 点击 **"Connect"** 按钮（或直接点击命令）
5. 会打开一个 Web Shell 窗口

### 5.2 执行初始化脚本

1. 在你的项目文件夹中，打开 **`init-postgres.sql`** 文件
2. **全选**文件中的所有内容（Ctrl+A）
3. **复制**（Ctrl+C）
4. 回到 Render 的 Web Shell 窗口
5. **粘贴**（Ctrl+V）到 Web Shell 中
6. 按 **Enter** 键执行

### 5.3 验证初始化成功

你应该看到类似这样的输出：

```
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE FUNCTION
CREATE TRIGGER
INSERT 0 1
```

如果看到这些消息，说明数据库初始化成功 ✅

**如果没有看到输出或出现错误：**
- 检查是否复制了完整的 SQL 内容
- 确认是在 Web Shell 中执行（不是在终端）
- 查看错误信息，告诉我具体错误

---

## 第六步：创建 Web 服务

### 6.1 创建新服务

1. 在 Render 控制台，点击右上角的 **"New +"** 按钮
2. 选择 **"Web Service"**

### 6.2 连接 GitHub 仓库

1. 如果是第一次使用，会提示连接 GitHub
2. 点击 **"Connect account"** 或 **"Configure account"**
3. 在 GitHub 授权页面，点击 **"Authorize render"**
4. 返回 Render，应该能看到你的 GitHub 仓库列表
5. 找到并选择 **"mathmaster"** 仓库
6. 点击 **"Connect"**

### 6.3 配置服务基本信息

填写以下信息：

| 配置项 | 值 | 说明 |
|--------|-----|------|
| **Name** | `mathmaster` | 服务名称（可以自定义） |
| **Region** | `Singapore` | 选择与数据库相同的区域 |
| **Branch** | `main` | Git 分支（通常是 main） |
| **Root Directory** | （留空） | 项目根目录，留空即可 |
| **Runtime** | `Node` | 选择 Node.js |
| **Build Command** | `npm install` | 构建命令 |
| **Start Command** | `npm start` | 启动命令 |

### 6.4 展开高级设置

1. 向下滚动，找到 **"Advanced"** 部分
2. 点击展开 **"Advanced"** 选项

---

## 第七步：配置环境变量

### 7.1 添加环境变量

在 **"Environment Variables"** 部分，点击 **"Add Environment Variable"**，逐个添加以下变量：

#### 变量 1：NODE_ENV
- **Key**: `NODE_ENV`
- **Value**: `production`
- 点击 **"Save"**

#### 变量 2：PORT
- **Key**: `PORT`
- **Value**: `3001`
- 点击 **"Save"**

#### 变量 3：JWT_SECRET
- **Key**: `JWT_SECRET`
- **Value**: 点击 **"Generate"** 按钮自动生成一个随机密钥
- 点击 **"Save"**

#### 变量 4：DB_TYPE
- **Key**: `DB_TYPE`
- **Value**: `postgres`
- 点击 **"Save"**

#### 变量 5：DB_HOST
- **Key**: `DB_HOST`
- **Value**: 从第四步提取的 `DB_HOST` 值
  - 例如：`dpg-xxxxx.singapore-postgres.render.com`
- 点击 **"Save"**

#### 变量 6：DB_USER
- **Key**: `DB_USER`
- **Value**: `mathmaster`（或从第四步提取的值）
- 点击 **"Save"**

#### 变量 7：DB_PASSWORD
- **Key**: `DB_PASSWORD`
- **Value**: 从第四步提取的 `DB_PASSWORD` 值
  - 例如：`abc123xyz`
- 点击 **"Save"**

#### 变量 8：DB_NAME
- **Key**: `DB_NAME`
- **Value**: `mathmaster`
- 点击 **"Save"**

#### 变量 9：DB_PORT
- **Key**: `DB_PORT`
- **Value**: `5432`
- 点击 **"Save"**

### 7.2 验证环境变量

添加完成后，你应该能看到 9 个环境变量：

```
✅ NODE_ENV = production
✅ PORT = 3001
✅ JWT_SECRET = (已生成)
✅ DB_TYPE = postgres
✅ DB_HOST = (你的主机地址)
✅ DB_USER = mathmaster
✅ DB_PASSWORD = (你的密码)
✅ DB_NAME = mathmaster
✅ DB_PORT = 5432
```

### 7.3 创建服务

1. 确认所有环境变量都已添加
2. 向下滚动到底部
3. 点击 **"Create Web Service"** 按钮

---

## 第八步：等待部署完成

### 8.1 查看部署进度

1. 创建服务后，会自动开始部署
2. 你会看到部署日志，显示构建进度：
   ```
   Building...
   → Installing dependencies
   → Starting service
   ```

### 8.2 等待部署完成

- **首次部署**通常需要 **5-10 分钟**
- 你可以看到实时的构建日志
- 等待状态变为 **"Live"**（绿色）

### 8.3 获取网站地址

1. 部署完成后，在服务详情页顶部
2. 你会看到一个 URL，格式类似：
   ```
   https://mathmaster.onrender.com
   ```
3. **这就是你的网站地址！** 🎉

### 8.4 测试网站

1. 点击网站地址，在浏览器中打开
2. 你应该能看到 MathMaster 的首页
3. 尝试注册一个新账号
4. 尝试登录

**如果一切正常，恭喜你！网站部署成功！** ✅

---

## 常见问题解答

### ❓ 问题 1：部署失败，显示 "Build failed"

**可能原因：**
- 环境变量配置错误
- 代码有语法错误
- 依赖安装失败

**解决方法：**
1. 点击服务详情页的 **"Logs"** 标签
2. 查看错误信息
3. 检查环境变量是否正确
4. 确认所有代码已上传到 GitHub

---

### ❓ 问题 2：网站打开很慢，或显示 "Application is starting"

**原因：**
Render 免费套餐在 **15 分钟无访问后会休眠**，首次访问需要 **30-60 秒**唤醒。

**解决方法：**
- 这是正常现象，等待 30-60 秒即可
- 如果想避免休眠，可以升级到付费套餐

---

### ❓ 问题 3：数据库连接失败

**可能原因：**
- 环境变量配置错误
- 数据库未初始化
- 数据库服务未启动

**解决方法：**
1. 检查环境变量中的数据库信息是否正确
2. 确认数据库服务状态为 **"Available"**
3. 确认已执行 `init-postgres.sql` 初始化脚本
4. 查看服务日志中的具体错误信息

---

### ❓ 问题 4：注册/登录功能不工作

**可能原因：**
- 数据库未初始化
- 数据库连接失败
- API 路由错误

**解决方法：**
1. 确认数据库已初始化（执行了 `init-postgres.sql`）
2. 检查服务日志，查看是否有数据库连接错误
3. 在浏览器中打开开发者工具（F12），查看控制台错误

---

### ❓ 问题 5：如何更新网站代码？

**方法：**
1. 在本地修改代码
2. 使用 GitHub Desktop 提交并推送更改
3. Render 会自动检测并重新部署
4. 或在 Render 控制台手动点击 **"Manual Deploy"**

---

### ❓ 问题 6：忘记数据库密码怎么办？

**解决方法：**
1. 在 Render 数据库详情页
2. 找到 **"Connections"** 部分
3. 可以重置密码或查看新的连接 URL

---

### ❓ 问题 7：如何查看网站访问日志？

**方法：**
1. 在 Render 服务详情页
2. 点击 **"Logs"** 标签
3. 可以看到实时的访问日志和错误信息

---

### ❓ 问题 8：免费套餐有什么限制？

**Render 免费套餐限制：**
- ✅ 完全免费
- ⚠️ 15 分钟无访问后会休眠
- ⚠️ 首次访问需要 30-60 秒唤醒
- ⚠️ 每月有使用时间限制（通常足够个人项目使用）
- ✅ 提供免费域名（`.onrender.com`）
- ✅ 支持 HTTPS

---

## 🎉 部署完成！

恭喜你完成了 MathMaster 网站的部署！

### 接下来你可以：

1. **分享你的网站**：把网站地址分享给朋友
2. **自定义域名**：在 Render 中配置自己的域名（需要付费）
3. **监控网站**：在 Render 控制台查看访问统计
4. **更新功能**：修改代码后推送到 GitHub，自动部署

### 需要帮助？

如果遇到问题：
1. 查看 Render 的 **"Logs"** 标签页
2. 查看本文档的常见问题部分
3. 告诉我具体在哪一步出错，我会帮你解决

---

**祝你使用愉快！🚀**

